---
title: "ENVS-193DS Final"
author: "Wyatt Erickson"
date: 6/8/25
format: 
  html: 
    toc: true
message: false
warning: false
editor: visual
---

#### Github Repository

<https://github.com/werickson13/ENVS-193DS_spring-2025_final.git>

```{r}
# load packages
library(tidyverse)
library(gt)
library(janitor)
library(lubridate, warn.conflicts = FALSE)
library(scales)
library(ggeffects)
library(MuMIn)
library(DHARMa)

# reading in data
sst <- read.csv("~/Git_/ENVS-193DS_spring-2025_final/Data/SST_update2023.csv")
nest_boxes <- read.csv("~/Git_/ENVS-193DS_spring-2025_final/Data/occdist.csv")
```

## Problem 1. Research Writing

### a. Transparent Statistical Methods

In part one, they used a Pearson's correlation test, as the data points are continuous and correlation was brought up in the description. In part 2, they used a one-way ANOVA test, as they are comparing more than two means by one factor (nitrogen source).

### b. More Information Needed

The first extra test that should be done is an Tukey's HSD test, because the ANOVA (p = 0.02) tells us that there is a significant difference between nitrogen sources, but not which ones are the most different. The Tukey's HSD test would test the differences seen between each nitrogen source, and tell us which groups are actually different (in the form of difference values and confidence interval boundaries), as well as adjusted p-values (for example, p\<0.001) to avoid type one error.

The co-worker could also include analysis of the effect size (η²)which would give context for how much the grouping variable (sources of nitrogen) explains the response variable (average nitrogen load in kg/year).

### c. Suggestions for Rewriting

Part 1: We observed a \[strong, weak\] \[positive, negative\] relationship (Pearson's r = **correlation coefficient**) between distance from headwaters (km) and annual total nitrogen load (kg/year) (t(**degrees of freedom**) = **t value**, p = 0.03, ⍺ = **significance level**).

Part 2: We observed a \[small, medium, large\] difference (η² = **effect size**) in average nitrogen load (kg/year) between sources (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands)(one-way ANOVA, F(**degrees of freedom between groups, degrees of freedom within groups**) = **F value**, p = 0.02, ⍺ = **significance level**). On average, \[source 1\] tended to have less average nitrogen load than \[source 2\] (**mean difference 1** kg/year less, 95% CI: \[**lower bound, upper bound**\] kg/year) and \[source 3\] (**mean difference 2** kg/year less, 95% CI: \[**lower bound, upper bound**\] kg/year).

## Problem 2. Data Visualization

### a. Cleaning and Summarizing

```{r}
sst_clean <- sst |> # use sst data frame
  clean_names() |> # clean up column names
  mutate(year = factor(year(date), # create factor column displaying year
                      levels = c(2018,2019,2020,2021,2022,2023)), # use only these six years
         month = factor(month(date, label = TRUE), # sort by month
                        levels = month.abb, ordered = TRUE))|> # display abbreviated month names
    filter(!is.na(year)) |> # removes data from unwanted years
    group_by(year, month) |> # group year and month columns
    summarise(mean_monthly_sst = mean(temp, na.rm = TRUE)) |>  # calculate mean monthly sst
  ungroup()
slice_sample(sst_clean, n = 5) # show 5 rows of data frame
str(sst_clean) # show data frame structure
```

### b. Visualize the Data

```{r}
ggplot(sst_clean, aes(x = month, # create plot with sst_clean dataframe, x = month
                      y = mean_monthly_sst, # y axis is mean monthly sst
                      group = year, # data grouped in lines by year
                      color = year)) +# lines colored by year
  geom_point(size = 2, shape = 16, alpha = 1) + # add points to visualization
  geom_line(linewidth = 0.7) + # connect points with lines
  labs(
    x = "Month", # set x axis title
    y = "Mean monthly sea surface temperature (°C)", # set y axis title
    color = "Year" # set legend title
  ) +
  scale_color_manual(values = c( # select line colors
    "2018" = "#c6dbef",
    "2019" = "#9ecae1",
    "2020" = "#6baed6",
    "2021" = "#4292c6",
    "2022" = "#2171b5",
    "2023" = "#084594"
  )) +
  theme_bw() + # select theme with border
  theme( # set font sizes, hide grids, and move legend
    axis.title.x = element_text(size = 16), 
    axis.title.y = element_text(size = 16),
    axis.text.x = element_text(size = 12),
    axis.text.y = element_text(size = 12),
    panel.background = element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major = element_blank(),
    legend.position = c(0.1,0.76),
    legend.title = element_text(size = 15),
    legend.text = element_text(size = 12)
  )
```

## Problem 3. Data Analysis

```{r, echo = FALSE}
# cleaning and wrangling data
clean_nest_boxes <- nest_boxes |> 
  clean_names() |> # clean column names
  select(sp, edge_distance, season) 
```

### a. Response Variable

In this data set, 1s and 0s represent the presence (or absence) of each bird species (swift parrot, common starline, tree martin, or empty). A 1 in a column means "yes" for that observation (for example, a 1 in sp means there was a swift parrot found and a 1 in e means the box was empty) while a 0 in a column means "no" for that observation (for example, a 0 in the cs column means either a species other than the common starling was present, or it was empty.

### b. Purpose of Study

Swift Parrots are a critically endangered species with preferences for specific dimensions for their nests, which are provided by nest boxes that are being taken up by other species. Tree Martins are a native species that take up these nest boxes (but overall are a subordinate competitor) and Common Starlings are an introduced species that compete for nest boxes with Swift Parrots, with anecdotal evidence suggesting they can compete by destroying eggs of the Swift Parrot.

### c. Difference in "seasons"

The first "season" is 2016/2017, and the second "season" is 2019/2020. Since the boxes were placed in 2016, they were brand new to the area during the first season, and for the second season the surrounding wildlife had time to adapt and get used to their presence.

### d. Table of Models

| Model Number | Season | Distance to Forest Edge | Model Description |
|:--:|:--:|:--:|:--:|
| 0 |  |  | no predictors (null model) |
| 1 | X | X | all predictors (saturated model) |
| 2 | X |  | Season predictor only |
| 3 |  | X | Distance to forest edge predictor only |

### e. Run the Models

```{r, echo = FALSE}
model0 <- glm(sp ~ 1, # null model, formula with no predictors
             data = clean_nest_boxes,
             family = binomial) # use cleaned data frame

model1 <- glm(sp ~ edge_distance + season, #saturated model, use both predictors
              data = clean_nest_boxes,
              family = binomial) # use cleaned data frame

model2 <- glm(sp ~ season, # use only season predictor
              data = clean_nest_boxes,
              family = binomial) # use cleaned data frame

model3 <- glm(sp ~ edge_distance, # use only edge distance predictor
              data = clean_nest_boxes,
              family = binomial) # use cleaned data frame
```

### f. Check the Diagnostics

```{r, echo = FALSE}
plot(simulateResiduals(model0))
plot(simulateResiduals(model1))
plot(simulateResiduals(model2))
plot(simulateResiduals(model3))
```
